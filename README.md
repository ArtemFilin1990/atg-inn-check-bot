# atg-inn-check-bot

Telegram-–±–æ—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π –ø–æ –ò–ù–ù —á–µ—Ä–µ–∑ DaData API.  
–†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ [Amvera](https://amvera.ru) –≤ —Ä–µ–∂–∏–º–µ Webhook.

## –°—Ç–µ–∫

- Python 3.11+
- [aiogram](https://docs.aiogram.dev/) v3
- FastAPI + uvicorn (webhook)
- httpx (async HTTP, DaData)
- cachetools (–∫—ç—à –æ—Ç–≤–µ—Ç–æ–≤ DaData)

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- –ö–æ–º–∞–Ω–¥–∞ `/start` —Å –∫–Ω–æ–ø–∫–∞–º–∏: **üèÅ –°—Ç–∞—Ä—Ç**, **üëã –ü—Ä–∏–≤–µ—Ç**, **üîé –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ò–ù–ù**
- –í–≤–æ–¥ –ò–ù–ù (10 —Ü–∏—Ñ—Ä ‚Äî —é—Ä–ª–∏—Ü–æ, 12 —Ü–∏—Ñ—Ä ‚Äî –ò–ü) —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö —Å—É–º–º
- –ö–∞—Ä—Ç–æ—á–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏: –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, –ò–ù–ù/–û–ì–†–ù/–ö–ü–ü, –∞–¥—Ä–µ—Å, —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ, –û–ö–í–≠–î, —É—á—Ä–µ–¥–∏—Ç–µ–ª–∏, —Å—Ç–∞—Ç—É—Å
- Inline-–∫–Ω–æ–ø–∫–∏: **–ü–æ–¥—Ä–æ–±–Ω–µ–µ**, **–§–∏–ª–∏–∞–ª—ã** (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π), **–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∫–≤–∏–∑–∏—Ç—ã**
- Rate limiting: 25 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç [@BotFather](https://t.me/BotFather) |
| `DADATA_API_KEY` | API-–∫–ª—é—á [DaData](https://dadata.ru) |
| `WEBHOOK_URL` | –ü—É–±–ª–∏—á–Ω—ã–π URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–Ω–∞–ø—Ä. `https://myapp.amvera.io`) |
| `PORT` | –ü–æ—Ä—Ç uvicorn (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `8000`) |

## –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

```bash
pip install -r requirements.txt

export TELEGRAM_BOT_TOKEN=...
export DADATA_API_KEY=...
export WEBHOOK_URL=https://your-domain.example.com

uvicorn app.main:app --host 0.0.0.0 --port 8000
```

## –¢–µ—Å—Ç—ã

```bash
pip install pytest
python -m pytest tests/ -v
```

## –î–µ–ø–ª–æ–π –Ω–∞ Amvera

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ Amvera, —É–∫–∞–∂–∏—Ç–µ —Ç–∏–ø **Docker**.
2. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞.
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–¥ (git push / –∑–∞–≥—Ä—É–∑–∫–∞ –∞—Ä—Ö–∏–≤–∞).
4. Amvera —Å–æ–±–µ—Ä—ë—Ç Docker-–æ–±—Ä–∞–∑ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

Webhook (`POST /tg/webhook`) —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.  
Healthcheck –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `GET /health`.

